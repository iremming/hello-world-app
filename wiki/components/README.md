# Components

<!-- Component documentation is auto-generated by Epicraft when new components are built -->
<!-- Team members can edit these pages to add usage guidelines and business context -->

## Data Pipeline: Material Category Spend Breakdown by Plant (SCRUM-35)

### Overview
This pipeline provides material category spend analysis by plant, enabling procurement teams to analyze purchasing patterns and identify cost optimization opportunities across different manufacturing locations.

### SAP Integration
- **OData Service**: A_PurchaseOrderItemType
- **Source System**: SAP S/4HANA
- **Key Entities Connected**: Purchase orders, purchase order items, products

### Data Model Architecture

#### Staging Layer (`models/staging/sap/`)
- `stg_sap__purchase_order_items`: Raw SAP purchase order item data from EKPO table
- **Primary Key**: PurchaseOrder + PurchaseOrderItem
- **Source Mapping**: 
  - `PurchaseOrder` → `purchase_order` (EBELN)
  - `PurchaseOrderItem` → `purchase_order_item` (EBELP)
  - `Material` → `material` (MATNR)
  - `Plant` → `plant` (WERKS)
  - `MaterialGroup` → `material_group` (MATKL)

#### Intermediate Layer (`models/intermediate/`)
- `int_purchase_order_spend`: Joins purchase orders with line items, calculates spend
- `int_material_spend_by_plant`: Enriches with product master data for categorization

#### Mart Layer (`models/marts/procurement/`)
- `fct_material_category_spend_by_plant`: Final aggregated view by plant and material group
- **Aggregations**: Total spend amount, PO count, unique material count

### Business Logic
- Spend calculation: `order_quantity * net_price_amount`
- Grouping dimensions: Plant, Material Group
- Material categorization via product master data joins

### Extraction Script
- `scripts/extraction/extract_purchase_order_items.py`: Python async script for SAP OData API extraction
- **Authentication**: API key-based
- **Field Selection**: Optimized for relevant procurement analytics fields